# ==============================================
# Movie Rating MLOps Project - Makefile
# ì˜í™” í‰ì  ì˜ˆì¸¡ MLOps í”„ë¡œì íŠ¸ ìë™í™”
# ==============================================

.PHONY: help setup permissions build run start clean test

# ê¸°ë³¸ íƒ€ê²Ÿ (help í‘œì‹œ)
help:
	@echo "ğŸ¬ Movie Rating MLOps - Available Commands"
	@echo "=============================================="
	@echo "make setup        - í™˜ê²½ ì„¤ì • (í™˜ê²½ë³€ìˆ˜, ë””ë ‰í† ë¦¬)"
	@echo "make permissions  - ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ê¶Œí•œ ì„¤ì •"
	@echo "make build        - Docker ì´ë¯¸ì§€ ë¹Œë“œ"
	@echo "make run          - ê°œë°œ ì»¨í…Œì´ë„ˆ ì‹¤í–‰"
	@echo "make start        - ì „ì²´ ì„¤ì • ë° ì‹¤í–‰ (ì›í´ë¦­)"
	@echo "make clean        - ì»¨í…Œì´ë„ˆ ë° ì´ë¯¸ì§€ ì •ë¦¬"
	@echo "make test         - í…ŒìŠ¤íŠ¸ ì‹¤í–‰"
	@echo ""
	@echo "ğŸš€ ë¹ ë¥¸ ì‹œì‘: make start"

# ì‹¤í–‰ ê¶Œí•œ ì„¤ì •
permissions:
	@echo "ğŸ”§ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ê¶Œí•œ ì„¤ì • ì¤‘..."
	@chmod +x scripts/*.sh
	@echo "âœ… ì‹¤í–‰ ê¶Œí•œ ì„¤ì • ì™„ë£Œ!"

# í™˜ê²½ ì„¤ì •
setup: permissions
	@echo "âš™ï¸ í™˜ê²½ ì„¤ì • ì‹œì‘..."
	@./scripts/setup_env.sh

# Docker ì´ë¯¸ì§€ ë¹Œë“œ
build: permissions
	@echo "ğŸ³ Docker ì´ë¯¸ì§€ ë¹Œë“œ ì‹œì‘..."
	@./scripts/build_image.sh

# ê°œë°œ ì»¨í…Œì´ë„ˆ ì‹¤í–‰
run: permissions
	@echo "ğŸš€ ê°œë°œ ì»¨í…Œì´ë„ˆ ì‹¤í–‰ ì‹œì‘..."
	@./scripts/run_dev.sh

# ì›í´ë¦­ ì‹œì‘ (ì „ì²´ í”„ë¡œì„¸ìŠ¤)
start: permissions
	@echo "ğŸ¬ Movie Rating MLOps ì›í´ë¦­ ì‹œì‘!"
	@./scripts/quick_start.sh

# ì •ë¦¬ (ì»¨í…Œì´ë„ˆ ë° ì´ë¯¸ì§€ ì‚­ì œ)
clean:
	@echo "ğŸ§¹ í™˜ê²½ ì •ë¦¬ ì¤‘..."
	@-docker stop movie-rating-dev-container 2>/dev/null || true
	@-docker rm movie-rating-dev-container 2>/dev/null || true
	@-docker rmi movie-rating-dev:latest 2>/dev/null || true
	@echo "âœ… ì •ë¦¬ ì™„ë£Œ!"

# í…ŒìŠ¤íŠ¸ ì‹¤í–‰ (í–¥í›„ êµ¬í˜„)
test:
	@echo "ğŸ§ª í…ŒìŠ¤íŠ¸ ì‹¤í–‰..."
	@echo "âš ï¸  TODO: í…ŒìŠ¤íŠ¸ ì½”ë“œ êµ¬í˜„ í•„ìš”"

# ì»¨í…Œì´ë„ˆ ë‚´ë¶€ ì ‘ì†
shell:
	@echo "ğŸ”— ì»¨í…Œì´ë„ˆì— ì ‘ì†í•©ë‹ˆë‹¤..."
	@docker exec -it movie-rating-dev-container bash

# ì»¨í…Œì´ë„ˆ ë¡œê·¸ í™•ì¸
logs:
	@echo "ğŸ“ ì»¨í…Œì´ë„ˆ ë¡œê·¸ë¥¼ í™•ì¸í•©ë‹ˆë‹¤..."
	@docker logs movie-rating-dev-container

# ìƒíƒœ í™•ì¸
status:
	@echo "ğŸ“Š í”„ë¡œì íŠ¸ ìƒíƒœ í™•ì¸..."
	@echo ""
	@echo "ğŸ³ Docker ì´ë¯¸ì§€:"
	@docker images | grep movie-rating || echo "   ì´ë¯¸ì§€ ì—†ìŒ"
	@echo ""
	@echo "ğŸ“¦ ì‹¤í–‰ ì¤‘ì¸ ì»¨í…Œì´ë„ˆ:"
	@docker ps | grep movie-rating || echo "   ì‹¤í–‰ ì¤‘ì¸ ì»¨í…Œì´ë„ˆ ì—†ìŒ"
	@echo ""
	@echo "ğŸ“ í”„ë¡œì íŠ¸ íŒŒì¼:"
	@ls -la .env 2>/dev/null && echo "   âœ… .env íŒŒì¼ ì¡´ì¬" || echo "   âŒ .env íŒŒì¼ ì—†ìŒ"
	@ls -la Dockerfile 2>/dev/null && echo "   âœ… Dockerfile ì¡´ì¬" || echo "   âŒ Dockerfile ì—†ìŒ"